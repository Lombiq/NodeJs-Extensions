<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Import Project="$(LombiqNpmTargetsPath)/Lombiq.Npm.Targets.targets" Condition="Exists('$(LombiqNpmTargetsPath)/Lombiq.Npm.Targets.targets')" />

  <!-- Files that are generated during the build need to be added manually to the EmbeddedResource item group, else they
       won't be embedded in the DLL. See: https://github.com/dotnet/msbuild/issues/3271#issuecomment-386662451. -->
  <Target
    Name="AddGeneratedFilesToEmbeddedResourceList"
    AfterTargets="NpmDotnetPrebuild"
    BeforeTargets="GenerateStylesPipelineErrors">
    <ItemGroup>
      <EmbeddedResource Include="$(NodeJsGeneratedFiles)" WithCulture="false" Type="Non-Resx" />
    </ItemGroup>
  </Target>

  <!-- The messages to search for in the build output are defined in the package.json file. -->
  <Target
    Name="GenerateStylesPipelineErrors"
    AfterTargets="NpmDotnetPrebuild"
    BeforeTargets="Compile">
    <Message Text="Running GenerateStylesPipelineErrors for '$(MSBuildProjectName)'" />
    <Warning
      Code="NX01"
      Text="Stylelint error in Node.js Extensions script, check the build output for more information."
      Condition="$(PrebuildOutput.Contains('Error in styles pipeline: stylelint failed'))" />
    <Error
      Code="NX02"
      Text="Compilation error in Node.js Extensions script, check the build output for more information."
      Condition="$(PrebuildOutput.Contains('Error in styles pipeline: compilation failed'))" />
  </Target>
</Project>
